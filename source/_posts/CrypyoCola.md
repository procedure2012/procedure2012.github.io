---
title: CryptoCola!
date: 2020-03-30 18:49:18
categories: 科普
tags: 技术
---
> War, War never changes
> --- Fallout

看看上一篇文章都快是一年前的事情了，这么久什么都没干实在是惭愧……所幸赶上在德国隔离没事，补了补之前欠的的债。上次Hackathon之后早就想要用智能合约搞点事情，终于用了一个学期做了一个cryptokitties的超级简化版——CryptoCola，项目放在了我的[github页面](https://github.com/procedure2012/CryptoCola)上。

## Ethereum（以太坊）

说起以太坊和所有类似的虚拟货币，一定逃不开这一切的源头——[比特币](https://bitcoin.org/bitcoin.pdf)。众所周知，比特币是一种虚拟货币，是一种被炒各种资本上天的虚拟货币。然而，这些投机分子却没看到，真正值钱的并不是比特币本身，而是它背后的运行机制——区块链。比特币的创始人中本聪创建了第一个区块——创世区块。然后他鼓励大家用比特币进行交易，从而生成了一系列的转账操作。为了防止大家作弊（比如，重复使用同一个虚拟货币)，所有的交易都会被每个参与区块链的人看到。看到后，所有参与者都会试图去确认这这些交易，然后把这些交易打包成一个区块挂在区块链的最后。最先完成的那个人会得到比特币作为奖励。为了增加生成区块的难度，每个区块里包含的交易信息加上产生这个区块的人随机生成的一个数字，这些数据通过一个散列函数得到的值应该有某个规定好的特征，这个链才算有效。因为散列函数的密码学特征，没有人能逆向根据特征推测需要加上什么数字，只能一个一个试，期待自己运气足够好（为什么要人为增加难度，大家可以想一想）。整个过程就好像从数据中找比特币，所以被称为“挖矿“。

<a href="https://imgur.com/DpW51yz.png"><img src="https://i.imgur.com/DpW51yz.png" title="Bitcoin" /></a>

这样一看，区块链其实就是一个大型的分布式数据库，所有参与者维护这个数据库并获得奖励。随着参与区块链的人越来越多，有人就觉得这个数据库只存静态的数据有点太浪费了，既然有这么多人在维护，我们可以做一些更酷的事情，比如在数据库里存一些可以被任何人查看和调用的函数，所以以太坊和智能合约就应运而生。以太坊重新构建了一条区块链，并提供了solidity作为一个开发用编程语言。每个人现在不仅可以把交易信息留在区块链里，还可以用solidity写一个函数留在区块链里，每个人都能看到这个函数的源代码，并且可以调用这个函数。这个函数就叫做智能合约，这条新的区块链就是以太坊，而这个区块链的维护者的奖励也从比特币变成了以太币（ETH）。

<a href="https://imgur.com/FWVqneE.png"><img src="https://i.imgur.com/FWVqneE.png" title="Ehtereum" /></a>

为什么大家要大费周章的搞这个东西呢？最大的好处就是安全。任何数据只要被确认并加到了区块链里面，就意味着所有人都有一份备份，任何人对智能合约的修改和调用都是可以被检查到的，所有破坏行为都会被所有参与者看到。所有对智能合约的修改如果没有得到51%的参与者的支持都是不可能被认可的（51%攻击，具体不介绍了）。自从以太坊出现后，它所提供的solidity和智能合约技术可以让所有开发者不再需要自己独立的数据库和服务，而是直接利用以太坊作为后台服务，只需要把需要的功能函数发布到以太坊上，然后添加一个用于调用这些函数的前端接口就可以。

智能合约也有一个很大的限制，因为它们是被发布在区块链上，所以每个合约能够运行的操作数是被严格限制的，不然就会出现许多恶意代码影响区块链所有参与者的计算效率。所以一般很难用智能合约实现逻辑复杂或者需要大量操作的函数。使用者需要自己做出权衡。

## CryptoKitties（谜恋猫）

基于智能合约的思路，有人就开发出来各种各样的去中心化应用程序（DApp），这些应用没有中心服务器，而是依靠区块链上的智能合约和区块链中保存的各种交易数据作为服务器。因为这些应用都是基于以太坊开发的，交易使用的都是以太币，所以所有参与者（包括使用者和发布者）都是和一个以太币钱包绑定在一起的（想象一堆钱包在互相交易而不是一堆人）。谜恋猫（cryptokitties）就是其中之一。

<a href="https://imgur.com/lvmE2UN.png"><img src="https://i.imgur.com/lvmE2UN.png" title="我的喵咪" /></a>

谜恋猫是一款收集猫咪卡牌的游戏。每只猫咪有许多不同的特征（眼睛、胡须、毛色等等），根据不同特征的稀有程度，猫咪会有不同的价格。每个参与者都有两种方式获得猫咪：直接**购买**或者选择两只猫咪**配种**。**购买**是通过竞标的方式在规定时间内选择所有出价者中的最高值，而**配种**可以免费选择两个自家猫咪配种，或者花钱租一只别人拥有更稀有特征的猫咪和自家猫咪配种，提高后代继承稀有特征的几率。一只稀有猫咪往往能卖出极高的价格，所以如果你人品够好，也许能买两只普通猫，然后靠变异得到稀有特征，然后转手卖掉。为了防止无限次数的繁殖，每只猫咪在配种完成后有一个冷却时间，随着繁殖次数的增加，冷却时间会随之增加，以避免无限繁殖导致的猫咪贬值。

<div>
<a href="https://imgur.com/m4kyRkC.png"><img src="https://i.imgur.com/m4kyRkC.png" /></a>
<a href="https://imgur.com/ssjSv0Y.png"><img src="https://i.imgur.com/ssjSv0Y.png" title="感受稀有猫咪的一下交易和配种价格" /></a>
</div>

> 我一直怀疑这个就是一开始进来的一帮人，在还没有把价格炒起来之前囤积大量稀有猫咪，然后忽悠后入场的韭菜们接盘……因为我实在看不出这些没有艺术价值，没有对应实物的猫咪图画为什么值这么多钱……想要理解区块链和智能合约的工作原理可以买两只便宜的实验一下，想靠这个拼一枪的还是趁早死心吧。

## CryptoCola!

哈哈，终于到了我出场的时候了！谜恋猫是一个基于智能合约的应用，而发布在区块链上的智能合是完全透明的，源码可见。所以我就基于谜恋猫的源码，搞了一个自己的简化版本——谜恋可乐！

<a href="https://imgur.com/0IxZBlc.png"><img src="https://i.imgur.com/0IxZBlc.png" title="忽略我打错的标题……" /></a>

和谜恋猫有自己的特征一样，每个可乐都有自己的一个编号，这个编号是根据用户和可乐命名随机生成的，虽然我的简化版里没有稀有性的概念，但也许未来它可以用于指代可乐的稀有性。有**购买**、**混合**和**生产**三种方式可以生成新的可乐。**购买**就是直接从别的用户手中购买被挂在可乐市场上出售的可乐，**混合**就是靠自己手中的两瓶可乐混合出一瓶新的可乐，**生产**则是由合约拥有者帮用户生产一瓶全新的可乐，但只有在当前拥有少于两瓶可乐的情况下才可以生产新的可乐，并且需要支付给合约拥有者相应的生产费用。作为一个简化版，我的可乐也有**混合**的冷却时间，不过是固定的1分钟。

<a href="https://imgur.com/0RZdOtT.png"><img src="https://i.imgur.com/0RZdOtT.jpg" title="可乐交易" /></a>

虽然后端的代码可以参考别人的代码，但是界面什么的还是要自己写的。我用react写了一个非常简单的的前端界面。因为html和css基本没怎用写过，所以不是很美观，但依靠react-bootstrap已经构建好的组件，能尽量保证规整。最一开始的设想是要给每个可乐添加一个对应的图标，而这个图标是根据可乐的编号自动生成的。比如说，现在的编号是16位的，用前0-3位表示瓶盖的样子，4-7位表示瓶身的样子，8-11位表示背景的样子，12-15位表示瓶身上标签的样子。这样我需要10000个瓶盖的图，10000个瓶身的图，10000个标签的图，10000个背景的图，40000个图一共可以组合出10000^4种瓶子图标，即使工作量太大，也可以只用16位中的4位，这样只要40个图就能组合出10000种图标。但可惜的是，没有美工我一幅图片也画不出来……

<a href="https://imgur.com/lMUkfbz.png"><img src="https://i.imgur.com/lMUkfbz.png" title="可乐展示" /></a>

---

收工！整体上来说只是一个很简单的项目，不过区块链和前端界面该涉及到的基本概念都包含到了，还解决了无数个环境配置上莫名其妙的bug……接下来还有好多好多想做的事情没有做（太监了的“人工智能vs古神的低语”），这个项目该学的都学到了，所以大概率不会继续完善这个东西了。说句题外话，真的是无论什么样的技术，都会有人拿来做买椟还珠的事情，把社会进步放在一旁，去做些谋取暴利的勾当，愚蠢是无药可救的……
